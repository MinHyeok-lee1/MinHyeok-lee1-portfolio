# 💥 Arduino 이슈 정리

Arduino 개발 중 자주 발생하는 **이슈 및 해결법**을 하드웨어/소프트웨어/통신/라이브러리/환경 설정 문제 등으로 나누어 정리

---

## 🛠️ 1. 업로드/포트 관련 이슈

| 증상                                      | 원인                               | 해결 방법                                 |
| ----------------------------------------- | ---------------------------------- | ----------------------------------------- |
| 🔌 포트가 안 보임                         | USB 드라이버 미설치                | CH340, CP210x 등 드라이버 설치            |
| 🔧 업로드 실패 (`avrdude: stk500_recv()`) | 보드 설정 오류 / 포트 오류         | 올바른 보드/포트 선택 확인                |
| 🔄 업로드 중 리셋이 반복됨                | 보드 전원 불안정 / USB 케이블 문제 | 정품 USB 케이블 사용, 다른 포트 시도      |
| 🧱 업로드 이후 동작 안함                  | `bootloader` 손상 가능성           | ISP로 부트로더 재업로드 필요 (예: USBasp) |

---

## 💻 2. 코드/라이브러리 이슈

| 증상                                  | 원인                          | 해결 방법                            |
| ------------------------------------- | ----------------------------- | ------------------------------------ |
| 🧩 `xxx.h: No such file or directory` | 라이브러리 미설치             | 라이브러리 매니저에서 설치           |
| ⛔ 충돌 오류 (`multiple definition`)  | 같은 함수 중복 정의           | .ino 파일과 .cpp 파일 이름 중복 확인 |
| 🔁 `WDT reset`, 무한 재부팅           | 무한 루프, 메모리 누수 등     | 코드 점검, delay나 yield() 추가      |
| 📦 예제 실행 안됨                     | 보드와 라이브러리 버전 불일치 | 보드 매니저/라이브러리 최신화 확인   |

---

## 🔌 3. 통신 이슈 (Serial, I2C, SPI)

| 증상                            | 원인                          | 해결 방법                         |
| ------------------------------- | ----------------------------- | --------------------------------- |
| 📭 시리얼 통신 데이터가 안 보임 | `Serial.begin()` 미호출       | setup()에 Serial.begin(9600) 추가 |
| 📉 I2C 통신 실패                | 주소 또는 풀업 저항 문제      | 주소 확인, 4.7kΩ 풀업 저항 확인   |
| 🚫 SPI 통신 불능                | MISO/MOSI/SCK/SS 핀 잘못됨    | 보드 핀맵 문서 참고, 핀 확인      |
| 📶 값이 엉뚱하게 나옴           | 통신 속도 차이, 엔디안 불일치 | SPI/I2C 설정값 일치시키기         |

---

## 🔋 4. 전원 및 하드웨어 이슈

| 증상               | 원인                  | 해결 방법                         |
| ------------------ | --------------------- | --------------------------------- |
| 🔌 리셋 반복       | 전류 부족, 전압 강하  | 외부 전원 또는 안정된 5V 공급     |
| 🔥 발열, 부품 손상 | 전류 초과, GND 미연결 | 모터/LED 전류 제한, 공통 GND 필수 |
| 🔦 LED 안 켜짐     | `pinMode()` 설정 누락 | `pinMode(pin, OUTPUT)` 추가       |
| 🔄 이상 동작       | 플로팅 핀 사용        | 풀업/풀다운 설정 확인             |

---

## ⚙️ 5. PlatformIO/VS Code 이슈

| 증상                     | 원인                | 해결 방법                                     |
| ------------------------ | ------------------- | --------------------------------------------- |
| ⚠️ 빌드 실패             | 환경설정 누락       | `platformio.ini` 파일 확인                    |
| 📡 시리얼 모니터 안 열림 | 포트 설정 오류      | 올바른 포트와 속도 지정                       |
| 🧵 다중 파일 컴파일 오류 | 헤더 파일 경로 문제 | `#include "파일명.h"` 확인, include 폴더 활용 |

---

## 📂 6. 기타 디버깅 팁

- **시리얼 로그**: `Serial.println()`으로 상태 출력
- **LED 점멸 디버깅**: 핀에 LED 연결 후 코드 흐름 확인
- **`F()` 매크로**: `Serial.print(F("문자열"))`로 메모리 절약
- **Watchdog 타이머**: `wdt_enable(WDTO_1S);` 사용 시 조심

---

## 🧰 보너스: 자주 사용하는 해결 팁

- `Ctrl + Shift + M`: 시리얼 모니터 빠른 실행
- 보드 재설정 후 1초 이내 업로드 시도 → 부트로더 문제 회피
- 라이브러리 충돌 시 `.pio/libdeps` 폴더 삭제 후 재빌드
- ATmega328P 사용 시 SRAM 2KB 제한 주의 (전역 배열 등 과다할당 주의)

---

## ⚙️ ATmega2560 (Arduino Mega 2560) 이슈 정리

### ✅ 1. 기본 정보

| 항목                 | 내용                        |
| -------------------- | --------------------------- |
| MCU                  | ATmega2560                  |
| 플래시 메모리        | 256KB (8KB 부트로더용 예약) |
| SRAM                 | 8KB                         |
| EEPROM               | 4KB                         |
| 디지털 I/O           | 54개 (15개 PWM 출력 가능)   |
| 아날로그 입력        | 16개                        |
| 하드웨어 시리얼 포트 | 4개 (Serial0 \~ Serial3)    |
| 최대 클럭            | 16MHz                       |

---

### 🔌 2. 업로드/포트 문제

| 증상                             | 원인                   | 해결 방법                                |
| -------------------------------- | ---------------------- | ---------------------------------------- |
| 🔄 업로드 실패                   | 보드 or 포트 선택 오류 | `Tools > Board > Arduino Mega 2560` 확인 |
| 🧱 업로드 중 LED가 깜빡이다 멈춤 | 부트로더 손상 가능성   | ISP로 부트로더 복구 (USBasp 등 사용)     |
| 📉 업로드는 되지만 실행이 안됨   | 전원 불안정, 코드 오류 | 외부 5V 전원 공급 또는 코드 점검         |

---

### 🧩 3. 라이브러리/메모리 이슈

| 증상                         | 원인                       | 해결 방법                                                  |
| ---------------------------- | -------------------------- | ---------------------------------------------------------- |
| ⛔ 메모리 초과 오류          | SRAM 부족 (8KB)            | 문자열 `F()` 사용, 전역 변수 최소화                        |
| ⚠️ 라이브러리 호환 오류      | 일부 라이브러리가 Uno 전용 | 라이브러리 소스에서 `#if defined(__AVR_ATmega2560__)` 추가 |
| 🧩 `Serial1`\~`Serial3` 안됨 | 초기화 누락                | `Serial1.begin(9600);` 등 직접 선언 필요                   |

---

### 📡 4. 시리얼 통신 이슈 (Serial0 \~ Serial3)

| 포트      | 설명                          |
| --------- | ----------------------------- |
| `Serial`  | USB 통신용 (Serial Monitor용) |
| `Serial1` | TX1 = 18, RX1 = 19            |
| `Serial2` | TX2 = 16, RX2 = 17            |
| `Serial3` | TX3 = 14, RX3 = 15            |

> ✅ **주의**: 여러 개의 UART를 사용할 때는 충돌 방지를 위해 `.begin()`과 `.end()`를 명확히 사용하고, RX 버퍼 초과 여부도 체크하세요 (`SerialX.available()`).

---

### 🧠 5. 인터럽트 & 타이머

- **외부 인터럽트 핀**: 2~~3, 18~~21 (총 6개 사용 가능)
- **타이머 채널 수 많음**: 16비트 타이머 4개(Timer1\~5), 8비트 타이머 2개(Timer0,2)
- **PWM 핀**: 2~~13, 44~~46 사용 가능

> 🎯 다양한 타이머와 핀 활용이 가능하지만, 타이머를 직접 사용하는 라이브러리들과의 충돌 주의!

---

### 🔌 6. 전원 공급 주의사항

| 방식  | 설명                                    |
| ----- | --------------------------------------- |
| USB   | 5V/500mA 이하 (기본 개발용)             |
| VIN   | 7\~12V 권장 (최대 20V)                  |
| 5V 핀 | 외부 전원 사용 시 입력 금지 (손상 위험) |

> 🔋 센서나 모터 구동 시에는 반드시 **외부 전원 사용 + GND 공유**를 고려하세요.

---

### 🧰 7. PlatformIO 환경 설정 (선택)

```ini
[env:mega2560]
platform = atmelavr
board = megaatmega2560
framework = arduino
monitor_speed = 115200
```

> ⏱️ 기본 Serial 속도는 115200 또는 9600 사용 권장

---

### 📎 8. 추천 디버깅 팁

- **Serial1\~3**를 센서 디버깅 용도로 분리 사용
- **`Serial.print(F("문자열"))`**: 플래시 사용으로 SRAM 절약
- **Pin 이름 헷갈림**: Mega 전용 핀맵 꼭 확인
