# **π›΅οΈ STM32μ—μ„μ μΈν„°λ½νΈ(Interrupt) μ‹μ¤ν…**

---

## **π“ κΈ°λ³Έ κ°λ…**

- **μΈν„°λ½νΈ(Interrupt)**λ€?
  - CPUκ°€ λ‹¤λ¥Έ μ‘μ—…μ„ μν–‰ μ¤‘μ΄λΌκ³  κ°€μ •
  - **μ™Έλ¶€ μ‹ νΈλ‚ ν•λ“μ›¨μ–΄ μ΄λ²¤νΈ**κ°€ λ°μƒ
  - ν„μ¬ μ‘μ—…μ„ μΌμ‹ μ¤‘λ‹¨ν•κ³  **κΈ΄κΈ‰ μ²λ¦¬**λ¥Ό μν–‰ν•λ” μ‹μ¤ν…
- STM32λ” Cortex-M κΈ°λ°μ΄λΌ
  - **Nested Vectored Interrupt Controller (NVIC)** κ°€ μΈν„°λ½νΈλ¥Ό κ΄€λ¦¬ν•¨

---

## **β™οΈ μΈν„°λ½νΈ μ²λ¦¬ νλ¦„**

1.  **μΈν„°λ½νΈ λ°μƒ** (ex: λ²„νΌ λλ¦Ό, UART λ°μ΄ν„° μμ‹  μ™„λ£)
2.  **NVICκ°€ κ°μ§€**ν•μ—¬ ν„μ¬ μ‹¤ν–‰ μ¤‘μΈ μ½”λ“ μ¤‘λ‹¨
3.  **μΈν„°λ½νΈ μ„λΉ„μ¤ λ£¨ν‹΄(ISR)** μΌλ΅ μ΄λ™
4.  ISR μ½”λ“ μ‹¤ν–‰
5.  **`return from interrupt`** λ…λ ΉμΌλ΅ μ΄μ „ μ½”λ“ λ³µκ·€

---

## **π”§ STM32 μΈν„°λ½νΈ μ£Όμ” κµ¬μ„± μ”μ†**

| **κµ¬μ„±μ”μ†**                    | **μ„¤λ…**                                                               |
| ------------------------------- | ---------------------------------------------------------------------- |
| EXTI                            | External Interrupts (GPIO ν•€ λ³€ν™”λ¥Ό μΈν„°λ½νΈλ΅ μ‚¬μ©)                   |
| NVIC                            | Nested Vectored Interrupt Controller, μΈν„°λ½νΈ μ°μ„ μμ„ λ° ν™μ„±ν™” λ‹΄λ‹Ή |
| ISR (Interrupt Service Routine) | μ‹¤μ  μΈν„°λ½νΈ λ°μƒ μ‹ μ²λ¦¬ν•  μ‚¬μ©μ ν•¨μ                               |

---

## **π› οΈ μΈν„°λ½νΈ ν™μ„±ν™” κΈ°λ³Έ μ μ°¨**

1.  **IRQ ν•Έλ“¤λ¬ ν•¨μ μ‘μ„±**
    - ex) `void EXTI0_IRQHandler(void)`
2.  **μΈν„°λ½νΈ μ†μ¤ μ„¤μ •**
    - EXTI, UART, TIM λ“± μ΄λ²¤νΈλ¥Ό μΈν„°λ½νΈλ΅ μ„¤μ •
3.  **NVICμ— μΈν„°λ½νΈ λ“±λ΅ λ° ν™μ„±ν™”**
    - `HAL_NVIC_SetPriority()`
    - `HAL_NVIC_EnableIRQ()`
4.  **ISR μ•μ—μ„ μ²λ¦¬ ν›„ μΈν„°λ½νΈ ν”λκ·Έ ν΄λ¦¬μ–΄**
    - ν”λκ·Έλ¥Ό ν΄λ¦¬μ–΄ν•μ§€ μ•μΌλ©΄ μΈν„°λ½νΈ κ³„μ† λ°μƒ

---

## **π–¥οΈ μ½”λ“ μμ : EXTI λ²„νΌ μΈν„°λ½νΈ μ„¤μ •**

```
// 1. GPIOλ¥Ό μΈν„°λ½νΈ λ¨λ“λ΅ μ΄κΈ°ν™”
GPIO_InitTypeDef GPIO_InitStruct = {0};
__HAL_RCC_GPIOA_CLK_ENABLE();
GPIO_InitStruct.Pin = GPIO_PIN_0;
GPIO_InitStruct.Mode = GPIO_MODE_IT_RISING;
GPIO_InitStruct.Pull = GPIO_NOPULL;
HAL_GPIO_Init(GPIOA, &GPIO_InitStruct);

// 2. NVIC μ„¤μ •
HAL_NVIC_SetPriority(EXTI0_IRQn, 2, 0);
HAL_NVIC_EnableIRQ(EXTI0_IRQn);

// 3. μΈν„°λ½νΈ ν•Έλ“¤λ¬ μ‘μ„±
void EXTI0_IRQHandler(void)
{
    HAL_GPIO_EXTI_IRQHandler(GPIO_PIN_0);  // HAL λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©μ‹
}

void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
    if (GPIO_Pin == GPIO_PIN_0)
    {
        // λ²„νΌ λλ €μ„ λ• μ²λ¦¬ν•  λ‚΄μ©
    }
}
```

---

## **π§© μΈν„°λ½νΈ μ°μ„ μμ„ (Priority)**

- **Preemption Priority**: λ‹¤λ¥Έ μΈν„°λ½νΈλ¥Ό μ¤‘λ‹¨ν•κ³  λ¨Όμ € μ‹¤ν–‰ν•  μ μλ” λ λ²¨
- **Sub Priority**: κ°™μ€ Preemption Priority μ•μ—μ„ μ‹¤ν–‰ μμ„λ¥Ό μ •ν•λ” λ λ²¨

STM32μ—μ„λ” `HAL_NVIC_SetPriority(IRQn, preemptPriority, subPriority);`λ΅ μ„¤μ •

---

## **ποΈ μΈν„°λ½νΈμ μ¥μ **

- μ‹¤μ‹κ°„ λ°μ‘ κ°€λ¥
- CPU μμ›μ„ ν¨μ¨μ μΌλ΅ μ‚¬μ©
- μ €μ „λ ¥ μ‹μ¤ν…μ—μ„ νΉν μ λ¦¬

---

## **β΅ μ£Όμμ‚¬ν•­**

- ISR μ•μ—μ„λ” **μ§§κ³  λΉ λ¥΄κ² μ²λ¦¬**ν•  κ²ƒ
  - (λλ¦° μ‘μ—…μ€ ν”λκ·Έλ§ μ„Έμ°κ³  λ©”μΈλ£¨ν”„μ—μ„ μ²λ¦¬)
- ISR λ‚΄λ¶€μ—μ„λ” **λΈ”λ΅ν‚Ή ν•¨μ μ‚¬μ© κΈμ§€**
  - (μ: `HAL_Delay()` κ°™μ€ κ±° μ‚¬μ©ν•λ©΄ μ‹μ¤ν… λ©μ¶¤)
- μΈν„°λ½νΈ **ν”λκ·Έ ν΄λ¦¬μ–΄ ν•„μ**
  - ν΄λ¦¬μ–΄ μ• ν•λ©΄ μΈν„°λ½νΈκ°€ κ³„μ† λ°μƒν•¨

---

## **π§  ν• λ¬Έμ¥ μ”μ•½**

> **"STM32 μΈν„°λ½νΈλ” NVICκ°€ κ΄€λ¦¬ν•λ©°, λΉ λ¥΄κ² μ΄λ²¤νΈλ¥Ό κ°μ§€ν•κ³  μ²λ¦¬ν•λ” μ‹¤μ‹κ°„ μ‹μ¤ν… ν•µμ‹¬ κΈ°λ¥"**
