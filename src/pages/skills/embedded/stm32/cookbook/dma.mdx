# **π€ STM32μ—μ„μ DMA(Direct Memory Access)**

---

## **π“ κΈ°λ³Έ κ°λ…**

- **DMAλ€?**
  - CPUλ¥Ό κ±°μΉμ§€ μ•μ
  - **λ©”λ¨λ¦¬ β†” μ£Όλ³€μ¥μΉ**, λλ” **λ©”λ¨λ¦¬ β†” λ©”λ¨λ¦¬** κ°„μ— μ „μ†΅
  - **μ§μ ‘ λ°μ΄ν„° μ „μ†΅**μ„ μν–‰ν•λ” ν•λ“μ›¨μ–΄ λ¨λ“
- CPUκ°€ λ°μ΄ν„° μ „μ†΅μ— κ΄€μ—¬ν•μ§€ μ•κΈ° λ•λ¬Έμ— μ•„λ κ°€λ¥
  - CPUλ” **λ‹¤λ¥Έ μ‘μ—…μ— μ§‘μ¤‘** κ°€λ¥ β†’ **μ„±λ¥ μµμ ν™”**

---

## **β™οΈ STM32 DMA κµ¬μ΅°**

STM32 MCUλ” **DMA μ»¨νΈλ΅¤λ¬**λ¥Ό λ‚΄μ¥ν•κ³  μμ

- λ³΄ν†µ μ—¬λ¬ κ°μ **Stream/Channel** μ§€μ›
- κ°κ° **Source Address β†’ Destination Address** μ „μ†΅ μ§€μ›
- λ°μ΄ν„° μ „μ†΅μ΄ λλ‚κ±°λ‚, μ—λ¬ λ°μƒ μ‹ **μΈν„°λ½νΈ** λ°μƒ κ°€λ¥

**STM32F7 κΈ°μ¤€**

- **DMA1**, **DMA2** μ»¨νΈλ΅¤λ¬
- κ°κ° λ‹¤μμ **Stream** μ κ³µ (ex: DMA2_Stream0)

---

## **π› οΈ DMA κΈ°λ³Έ μ „μ†΅ νλ¦„**

1.  DMA μ»¨νΈλ΅¤λ¬μ— **μ†μ¤ μ£Όμ†**, **λ©μ μ§€ μ£Όμ†**, **μ „μ†΅ ν¬κΈ°** μ„¤μ •
2.  DMA μ¤νΈλ¦Όμ„ **Enable**
3.  μ„¤μ •λ λ°μ΄ν„° μλ™ μ „μ†΅
4.  μ „μ†΅ μ™„λ£ ν›„ **μΈν„°λ½νΈ λ°μƒ** λλ” **ν”λκ·Έ μ„Έν…**

---

## **π”§ DMA μ£Όμ” μ„¤μ • ν•­λ©**

| **ν•­λ©**           | **μ„¤λ…**                                        |
| ------------------ | ----------------------------------------------- |
| μ†μ¤ μ£Όμ†          | λ°μ΄ν„°κ°€ λ³µμ‚¬λ  **μ‹μ‘ μ£Όμ†**                   |
| λ©μ μ§€ μ£Όμ†        | λ°μ΄ν„°κ°€ μ „μ†΅λ  **λ©μ μ§€ μ£Όμ†**                 |
| λ°μ΄ν„° μ‚¬μ΄μ¦      | λ°”μ΄νΈ, ν•ν”„μ›λ“(16λΉ„νΈ), μ›λ“(32λΉ„νΈ)          |
| μ „μ†΅ λ°©ν–¥          | λ©”λ¨λ¦¬β†’λ©”λ¨λ¦¬, λ©”λ¨λ¦¬β†’μ£Όλ³€μ¥μΉ, μ£Όλ³€μ¥μΉβ†’λ©”λ¨λ¦¬ |
| λ²„μ¤νΈ μ „μ†΅        | κ³ μ† λ°μ΄ν„° μ „μ†΅μ„ μ„ν•΄ μ—¬λ¬ λ°μ΄ν„° λ¬¶μ μ „μ†΅   |
| FIFO μ‚¬μ© μ—¬λ¶€     | λ°μ΄ν„° μ „μ†΅ μ¤‘ λ²„νΌλ§ κΈ°λ¥                      |
| μ „μ†΅ μ™„λ£ μΈν„°λ½νΈ | λ°μ΄ν„° μ „μ†΅μ΄ λλ‚λ©΄ νΈμ¶                       |

---

## **π–¥οΈ μ½”λ“ μμ : λ©”λ¨λ¦¬ β†’ λ©”λ¨λ¦¬ λ³µμ‚¬ (HAL)**

```
// 1. DMA ν•Έλ“¤ μ„ μ–Έ
DMA_HandleTypeDef hdma_memtomem;

// 2. DMA μ΄κΈ°ν™” (ex: STM32CubeMXμ—μ„ μλ™ μƒμ„± κ°€λ¥)
void MX_DMA_Init(void)
{
    __HAL_RCC_DMA2_CLK_ENABLE();

    hdma_memtomem.Instance = DMA2_Stream0;
    hdma_memtomem.Init.Channel = DMA_CHANNEL_0;
    hdma_memtomem.Init.Direction = DMA_MEMORY_TO_MEMORY;
    hdma_memtomem.Init.PeriphInc = DMA_PINC_ENABLE;
    hdma_memtomem.Init.MemInc = DMA_MINC_ENABLE;
    hdma_memtomem.Init.PeriphDataAlignment = DMA_PDATAALIGN_WORD;
    hdma_memtomem.Init.MemDataAlignment = DMA_MDATAALIGN_WORD;
    hdma_memtomem.Init.Mode = DMA_NORMAL;
    hdma_memtomem.Init.Priority = DMA_PRIORITY_LOW;
    hdma_memtomem.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
    HAL_DMA_Init(&hdma_memtomem);
}

// 3. μ „μ†΅ μ‹¤ν–‰
HAL_DMA_Start(&hdma_memtomem, (uint32_t)srcBuffer, (uint32_t)dstBuffer, bufferSize);
HAL_DMA_PollForTransfer(&hdma_memtomem, HAL_DMA_FULL_TRANSFER, HAL_MAX_DELAY);
```

---

## **π§© DMA μΈν„°λ½νΈ μ²λ¦¬ νλ¦„**

- DMA μ „μ†΅ μ™„λ£ μ‹ **μ½λ°± ν•¨μ** νΈμ¶ κ°€λ¥

```
void HAL_DMA_IRQHandler(DMA_HandleTypeDef *hdma)
{
    if (__HAL_DMA_GET_FLAG(hdma, DMA_FLAG_TCIF0_4))  // Transfer Complete
    {
        __HAL_DMA_CLEAR_FLAG(hdma, DMA_FLAG_TCIF0_4);
        // μ „μ†΅ μ™„λ£ μ²λ¦¬
    }
}
```

- HALμ—μ„λ” `HAL_DMA_IRQHandler()`μ™€ `HAL_DMA_XferCpltCallback()` κµ¬μ΅°λ¥Ό μ‚¬μ©ν•¨

---

## **ποΈ DMA μ‚¬μ©μ μ¥μ **

- CPU λ¶€ν• κ°μ† (νΉν λ€λ‰ λ°μ΄ν„° μ „μ†΅ μ‹)
- μ‹¤μ‹κ°„ μ„±λ¥ ν–¥μƒ
- μ „μ†΅ λ„μ¤‘ CPUκ°€ λ‹¤λ¥Έ μ‘μ—… μν–‰ κ°€λ¥ (λ³‘λ ¬ν™”)
- μ €μ „λ ¥ λ¨λ“μ—μ„λ„ λ°μ΄ν„° μ²λ¦¬ κ°€λ¥

---

## **β΅ μ£Όμμ‚¬ν•­**

- **DMA μ¶©λ λ°©μ§€**
  - κ°™μ€ μ¤νΈλ¦Ό/μ±„λ„μ„ λ™μ‹μ— μ—¬λ¬ μ‘μ—…μ— μ‚¬μ©ν•λ©΄ μ• λ¨
- **λ©”λ¨λ¦¬ μ •λ ¬** μ£Όμ
  - λ°”μ΄νΈ/ν•ν”„μ›λ“/μ›λ“ μ •λ ¬μ΄ λ§μ•„μ•Ό ν•¨
- **μΊμ‹ μΌκ΄€μ„± λ¬Έμ **
  - (νΉν Cortex-M7 λ“± μΊμ‹κ°€ μλ” MCU) μΊμ‹ λ¬΄ν¨ν™” ν•„μ”ν•  μ μμ
- **μΈν„°λ½νΈμ™€ ν”λκ·Έ μ²λ¦¬** λ…ν™•ν ν•΄μ•Ό ν•¨

---

## **π§  ν• λ¬Έμ¥ μ”μ•½**

> **"STM32μ DMAλ” CPU κ°μ… μ—†μ΄ λΉ λ¥΄κ³  ν¨μ¨μ μΌλ΅ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ” ν•λ“μ›¨μ–΄ κ°€μ† μ‹μ¤ν…"**
