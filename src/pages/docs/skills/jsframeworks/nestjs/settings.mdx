# NestJS 개발환경 구축 및 설정

## NestJS 개발환경 구축

### 1. NestJS 프로젝트 설치

Nest CLI를 사용하여 시작 프로젝트를 생성한다.
프로젝트를 설치하고자 하는 디렉토리에서 아래 명령어를 NestJS 프로젝트 폴더를 설치한다.

```sh
$ npm i -g @nestjs/cli
$ nest new project-name
```

- TypeScript는 명령어에 `--strict`를 추가한다.

```sh
$ nest new project-name --strict
```

<br />

### 2. 설치가 잘 되었는 지 아래 명령어로 확인한다.

```sh
$ nest --version
```

- 설치가 잘 되었다면 nestjs의 버전이 출력된다.

<br />

### 3. 수동 설치

npm (또는 yarn ) 으로 코어 및 지원 파일을 설치하여 처음부터 수동으로 새 프로젝트를 생성할 수도 있다.

```sh
$ npm i --save @nestjs/core @nestjs/common rxjs reflect-metadata
```

- 이 경우 프로젝트 상용구 파일을 직접 만들어야 하기 때문에 추천하지 않는다.

<br />

### 4. NestJS 시작

프로젝트 폴더에서 아래와 같은 명령어를 통해 프로젝트 개발을 시작할 수 있다.

#### 4-1. development mode

```sh
# npm 사용
npm run start

# pnpm 사용
pnpm start

# yarn 사용
yarn start
```

#### 4-2. watch mode

```sh
# npm 사용
npm run start:dev

# pnpm 사용
pnpm start:dev

# yarn 사용
yarn start:dev
```

#### 4-3. debug mode

```sh
# npm 사용
npm run start:debug

# pnpm 사용
pnpm start:debug

# yarn 사용
yarn start:debug
```

#### 4-4. production mode

```sh
# npm 사용
npm run start:prod

# pnpm 사용
pnpm start:prod

# yarn 사용
yarn start:prod
```

<br />

### 5. 테스트 실행

프로젝트 폴더에서 아래와 같은 명령어를 통해 프로젝트 테스트를 시작할 수 있다.

#### 5-1. 유닛 테스트 ( unit tests ) 실행

```sh
$ npm run test
```

#### 5-2. End to eEnd tests ( e2e tests) 실행

```sh
$ npm run test:e2e
```

#### 5-3. 테스트 커버리지 ( test coverage ) 실행

```sh
$ npm run test:cov
```

---

## NestJS 기반의 API 서버 개발

cli 설치

```sh
sudo npm i -g @nestjs/cli
```

프로젝트 생성

```sh
nest new ApiServer
```

---

## path alias 설정

src 디렉토리 하단에 있는 각 소스 구성들의 path alias 설정을 위해 tsconfig.json 파일에 아래의 내용을 추가한다.

```json
{
  "compilerOptions": {
    // ...
    "paths": {
      "@constants/*": ["./src/constants/*"],
      "@modules/*": ["./src/modules/*"],
      "@models/*": ["./src/models/*"],
      "@toolkit/*": ["./src/toolkit/*"]
    }
  }
}
```

---

## MongoDB 연동

API 서버에서 MongoDB를 이용하기 위해서는 kindagoose, typegoose, mongoose 패키지를 이용한다.

```sh
yarn add kindagoose @typegoose/typegoose mongoose
```

### typegoose

- Entity 개발: prop 데코레이터를 통해 모델을 정의한다.
- Service 개발: 서비스에서 사용할 모델의 타입 선언에 활용한다.

### kindagoose

- Module 개발: 모듈에 모델을 주입한다.
- Service: 모듈에서 주입한 모델에 대한 접근 권한 부여한다.

### mongoose

- Service 개발: MongoDB 쿼리 처리에 활용한다.

### nCloud MongoDB용 hosts 파일 등록

nCloud에서 제공하는 MongoDB 서비스의 경우 외부에서 접속하기 위해 /etc/hosts 파일에 아래의 내용을 추가한다.

```sh
223.130.128.225 e88j3.vpc.mg.naverncp.com
223.130.129.18 e88j7.vpc.mg.naverncp.com
```
